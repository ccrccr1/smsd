<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="spring.model.mapper.MemberMapper">

	<select id="iwritecontent" parameterType="String"
		resultType="CntDTO">
		SELECT '답변게시판' table_name, q_no no ,q_title title, q_date writedate FROM QNA WHERE M_ID LIKE '%'||#{m_id}||'%' 
		UNION
		SELECT '답변게시판 댓글' table_name,q_no no,qr_content title,qr_date wirtedate FROM REPLY WHERE M_ID LIKE '%'||#{m_id}||'%' 
		UNION
		SELECT '후기게시판' table_name,r_no no,r_title title,r_date writedate FROM REVIEW WHERE M_ID LIKE '%'||#{m_id}||'%' 
		UNION
		SELECT '모임게시판' table_name,b_no no,b_title title,b_date writedate FROM BOARD WHERE M_ID LIKE '%'||#{m_id}||'%' 
		UNION
		SELECT '모임게시판 댓글' table_name ,b_no no,br_content title,br_date writedate FROM BOARD_REPLY WHERE M_ID LIKE '%'||#{m_id}||'%' 
		
		
	</select>

	<select id="iwritecnt" parameterType="String"
		resultType="CntDTO">
		SELECT '답변게시판' table_name, COUNT(*) cnt FROM QNA WHERE M_ID LIKE '%'||#{m_id}||'%' 
		UNION
		SELECT '답변게시판 댓글' table_name, COUNT(*) cnt FROM REPLY WHERE M_ID LIKE '%'||#{m_id}||'%' 
		UNION
		SELECT '후기게시판' table_name , COUNT(*) cnt FROM REVIEW WHERE M_ID LIKE '%'||#{m_id}||'%' 
		UNION
		SELECT '모임게시판' table_name, COUNT(*) cnt FROM BOARD WHERE M_ID LIKE '%'||#{m_id}||'%' 
		UNION
		SELECT '모임게시판 댓글' table_name, COUNT(*) cnt FROM BOARD_REPLY WHERE M_ID LIKE
		'%'||#{m_id}||'%'
	</select>


	<update id="updatePw" parameterType="Map">
		update member
		set
		m_passwd =
		#{m_updatepasswd}
		where m_id = #{m_id}
	</update>

	<select id="passcheck" resultType="int" parameterType="Map">
		select
		count(*)
		from member
		where m_id = #{m_id}
		and m_passwd = #{m_passwd}
	</select>


	<select id="idcheck" resultType="int" parameterType="String">
		select
		count(m_id)
		from member
		where m_id = #{m_id}
	</select>

	<select id="emailcheck" resultType="int" parameterType="String">
		select
		count(m_email)
		from member
		where m_email = #{m_email}
	</select>
	<insert id="create" parameterType="MemberDTO">
		insert into member
		(m_id,m_name,m_email,m_passwd,m_phone,m_addr1,m_addr2,m_addr3,m_birth,
		m_date)
		values(#{m_id},#{m_name},#{m_email},#{m_passwd},#{m_phone1}||#{m_phone2}||#{m_phone3},#{m_addr1},
		#{m_addr2},#{m_addr3,jdbcType=VARCHAR},#{m_birth1}||#{m_birth2}||#{m_birth3},sysdate)
	</insert>
	<delete id="delete" parameterType="String">
		delete member where m_id =
		#{m_id}
	</delete>

	<select id="loginCheck" parameterType="Map" resultType="int">
		select
		count(m_id) as cnt
		from member
		where m_id=#{m_id} and
		m_passwd=#{m_passwd}
	</select>

	<select id="getGrade" parameterType="String" resultType="String">
		select
		m_grade from member
		where m_id = #{m_id}
	</select>

	<select id="read" parameterType="String" resultType="MemberDTO">
		select
		m_email,m_id,m_money ,m_name, m_phone, m_addr1,
		m_addr2,m_addr3,m_birth
		from member
		where m_id = #{m_id}
	</select>

	<update id="update" parameterType="MemberDTO">
		update member
		set

		m_phone = #{m_phone1}||#{m_phone2}||#{m_phone3},
		m_addr1 = #{m_addr1},
		m_addr2 = #{m_addr2},
		m_addr3 = #{m_addr3,jdbcType=VARCHAR},
		m_birth = #{m_birth1}||#{m_birth2}||#{m_birth3}

		where m_id=#{m_id}
	</update>

	<update id="updatemoney" parameterType="String">
		update member
		set
		m_money = m_money + to_number(#{m_updatemoney,jdbcType=INTEGER})
		where m_id=#{m_id}
	</update>

	<select id="findID" resultType="String" parameterType="Map">
		select
		m_id from member
		where m_name = #{m_name} and m_email = #{m_email}
	</select>
	<select id="findPW" resultType="String" parameterType="Map">
		select
		m_passwd from member
		where m_id = #{m_id} and m_email = #{m_email}
	</select>
</mapper>
