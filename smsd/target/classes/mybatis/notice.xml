<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="spring.model.mapper.NoticeMapper">

<delete id="delete" parameterType="int">
	delete from notice
	where n_no = #{n_no}
</delete>

<update id="update" parameterType="NoticeDTO">
	update notice set
	n_title = #{n_title},
	n_content = #{n_content}
	where n_no = #{n_no}
</update>

<insert id="create" parameterType="NoticeDTO">
	insert into notice (n_no, n_title, n_content, n_date, m_id)
	values((select nvl(max(n_no), 0) + 1 from notice),
	#{n_title}, #{n_content}, sysdate, 'admin')
</insert>

<select id="read" parameterType="int" resultType="NoticeDTO">
	select n_no, n_title, n_content, to_char(n_date, 'yyyy-mm-dd') n_date,
	n_cnt
	from notice
	where n_no = #{n_no}
</select>

<update id="upn_cnt" parameterType="int">
	update notice set
	n_cnt = n_cnt + 1
	where n_no = #{n_no}
</update>

<select id="list" parameterType="Map" resultType="NoticeDTO">
	select n_no, n_title, to_char(n_date, 'yyyy-mm-dd') n_date, n_cnt, r
   		from (
       	select n_no, n_title, n_date, n_cnt, rownum r
       		from (
           	select n_no, n_title, n_date, n_cnt
           		from notice
               	<where>
               		<choose>
               			<when test="col == 'n_title'">
               				n_title like '%'||#{word}||'%'
               			</when>
               			
               			<when test="col == 'n_content'">
               				n_content like '%'||#{word}||'%'
               			</when>
               			
               			<when test="col == 'n_title_n_content'">
               				n_title like '%'||#{word}||'%'
               				or
               				n_content like '%'||#{word}||'%'
               			</when>
               			
               			<when test="col == 'n_total'">
               				n_total like '%'||#{word}||'%'
               			</when>
               		</choose>
               	</where>
               	order by n_no desc
       		)
   		)
   	<![CDATA[
	where r >= #{sno} and r <= #{eno}
	]]>
</select>

<select id="total" parameterType="Map" resultType="int">
	select count(*) from notice
	<where>
		<choose>
			<when test="col == 'n_title'">
				n_title like '%'||#{word}||'%'
			</when>
			
			<when test="col == 'n_content'">
				n_content like '%'||#{word}||'%'
			</when>
			
			<when test="col == 'n_title_n_content'">
				n_title like '%'||#{word}||'%'
				or
				n_content like '%'||#{word}||'%'
			</when>
		</choose>
	</where>
</select>

</mapper>